<!-- Overlay -->
<div class="fixed inset-0  backdrop-blur-[2px] bg-black/50 bg-opacity-50 z-40 flex items-center justify-center overflow-y-auto">
  <!-- Popup Container -->
  <div class="relative bg-white rounded-[10px] xl:max-w-[45%] lg:max-w-[45%] md:max-w-[60%] sm:max-w-[80%] w-[95%] h-fit my-8 mx-auto">
    <!-- Close Button -->
    <button (click)="close.emit()" class="absolute lg:w-[40px] lg:h-[40px] w-[20px] h-[20px] lg:-right-11 -right-2 top-2 lg:top-0 sm:bg-[#0C1D2E] bg-white sm:opacity-70 sm:text-white font-bold flex items-center justify-center rounded-full z-50">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <!-- Content Container with max height and scrolling -->
    <div class="max-h-[85vh] overflow-y-auto">
      <!-- Header Section -->
      <div class="p-4">
        <span class="flex justify-between items-center">
          <div class="flex gap-2">
            <!-- Veg/Non-veg Indicator -->
            <div class="flex py-1">
              <div>
                <div class="h-4 w-4 border border-green-600 flex items-center justify-center cursor-pointer">
                  <div class="h-2 w-2 bg-green-600 rounded-full"></div>
                </div>
              </div>
            </div>
            <!-- Item Name -->
            <h2 class="text-[16px] text-[#0C1D2E] font-semibold flex flex-wrap items-center gap-2">
              {{item_name}}
              <span *ngIf="variation_name"><p class="text-sm">({{variation_name}})</p></span>
            </h2>
          </div>
          <!-- Favorite Icon -->
          <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none" class="cursor-pointer">
              <path d="M20.8405 4.77676C20.3297 4.26576 19.7233 3.8604 19.0558 3.58384C18.3884 3.30728 17.673 3.16493 16.9505 3.16493C16.228 3.16493 15.5126 3.30728 14.8451 3.58384C14.1777 3.8604 13.5712 4.26576 13.0605 4.77676L12.0005 5.83676L10.9405 4.77676C9.90879 3.74507 8.50952 3.16547 7.05049 3.16547C5.59145 3.16547 4.19218 3.74507 3.16049 4.77676C2.12879 5.80845 1.54919 7.20772 1.54919 8.66676C1.54919 10.1258 2.12879 11.5251 3.16049 12.5568L4.22048 13.6168L12.0005 21.3968L19.7805 13.6168L20.8405 12.5568C21.3515 12.046 21.7568 11.4396 22.0334 10.7721C22.31 10.1047 22.4523 9.38925 22.4523 8.66676C22.4523 7.94427 22.31 7.22886 22.0334 6.5614C21.7568 5.89394 21.3515 5.28751 20.8405 4.77676V4.77676Z" stroke="#748BA0" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            </svg>
          </div>
        </span>

        <!-- Description & Details -->
        <p class="pt-[12px] text-[16px] text-gray-400">{{description}}</p>
        <p *ngIf="nutrition" class="text-[14px] text-[#748BA0] font-[400] cursor-pointer">{{nutrition}}</p>
        <div class="lg:text-[20px] text-[16px] pt-[12px] sm:mb-4 flex items-center">
          <div class="font-[550] pr-[2px]">INR</div>{{price}}
        </div>

        <!-- Quantity Controls -->
        <div class="flex gap-[5%] justify-end items-end pt-[1%]">
          <!-- Note Button -->
          <div class="sm:w-[15%] w-[12%] sm:h-[7.8vh] h-[6vh] rounded-[10px] flex justify-center items-center bg-[#edf0f0] cursor-pointer">
            <svg width="19" height="21" viewBox="0 0 19 21" fill="#0C1D2E" xmlns="http://www.w3.org/2000/svg">
              <!-- Note icon paths -->
            </svg>
          </div>
          <!-- Counter -->
          <div class="w-[38%] sm:h-[7.8vh] h-[6vh] p-[13px] rounded-[10px] gap-[31%] flex justify-center items-center bg-[#edf0f0]">
            <p class="cursor-pointer flex items-center">
              <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" color="#748BA0" height="1em" width="1em">
                <path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"/>
              </svg>
            </p>
            <p class="text-center flex items-center text-[18px] font-bold text-[#748BA0]">1</p>
            <p class="cursor-pointer flex items-center">
              <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" color="#748BA0" height="1em" width="1em">
                <path d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"/>
              </svg>
            </p>
          </div>
        </div>
      </div>

      <!-- Variations Section -->
      <div *ngIf="item?.variation && item.variation.length > 0" class="mx-[3.8%] mb-2">
        <div class="rounded-[10px] border-2 border-[hsl(var(--border))] mb-2">
          <div class="flex justify-between items-center border-b-2 border-[hsl(var(--border))] py-[1%] cursor-pointer">
            <p class="px-[16px]">Variation</p>
            <p class="px-[16px]">
              <svg width="12" height="8" viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M0.599927 6.99625C0.866626 7.26791 1.29903 7.26791 1.56573 6.99625L5.9999 2.47945L10.4341 6.99625C10.7008 7.26791 11.1332 7.26791 11.3999 6.99625C11.6666 6.72458 11.6666 6.28411 11.3999 6.01244L6.4828 1.00375C6.21611 0.732079 5.7837 0.732079 5.517 1.00375L0.599927 6.01244C0.333227 6.28411 0.333227 6.72458 0.599927 6.99625Z" fill="#0C1D2E"/>
              </svg>
            </p>
          </div>
          <div class="overflow-y-auto max-h-[150px] px-[16px]">
            <div *ngFor="let variation of item.variation" class="flex justify-between items-center py-1">
              <span class="cursor-pointer" [class.text-[var(--temp-back)]]="variation === selectedVariation">
                <input type="radio" 
                       [checked]="variation === selectedVariation"
                       (click)="onVariationSelect(variation)" 
                       class="mr-2">
                {{variation.name}}
              </span>
              <span class="text-gray-500 flex items-center">
                <div class="font-[550] pr-[2px]">INR</div>{{variation.price}}
              </span>
            </div>
          </div>
        </div>

        <!-- Variation Addons -->
        <div *ngIf="selectedVariation?.variationallowaddon === 1 && item.variationAddonDetails && item.variationAddonDetails.length > 0">
          <div *ngFor="let addonGroup of getVariationAddons(selectedVariation); let i = index" 
               class="rounded-[10px] border-2 mb-4">
            <div class="flex item-center flex-col border-b-2 py-[1%] px-4">
              <div class="flex justify-between items-center cursor-pointer">
                <p>{{addonGroup.addon_group_name}}</p>
                <div class="flex items-center gap-4">
                  <p class="text-gray-500 text-sm">
                    ({{getSelectedCount(addonGroup)}}/{{getAddonMaxLimit(addonGroup, selectedVariation)}})
                  </p>
                  <p>
                    <svg width="12" height="8" viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M0.599927 6.99625C0.866626 7.26791 1.29903 7.26791 1.56573 6.99625L5.9999 2.47945L10.4341 6.99625C10.7008 7.26791 11.1332 7.26791 11.3999 6.99625C11.6666 6.72458 11.6666 6.28411 11.3999 6.01244L6.4828 1.00375C6.21611 0.732079 5.7837 0.732079 5.517 1.00375L0.599927 6.01244C0.333227 6.28411 0.333227 6.72458 0.599927 6.99625Z" fill="#0C1D2E"/>
                    </svg>
                  </p>
                </div>
              </div>
              <div *ngIf="getAddonMinLimit(addonGroup, selectedVariation) > 0" 
                   class="text-xs text-gray-500 flex items-end justify-end">
                Select at least {{getAddonMinLimit(addonGroup, selectedVariation)}} option
              </div>
            </div>
            <div class="px-[16px] py-[1px] max-h-[20vh] custom-scrollbar overflow-y-auto">
              <div *ngFor="let item of addonGroup.addon_group_items; let j = index"
                   class="flex justify-between relative items-center mb-1">
                <div class="flex items-center">
                  <input type="checkbox" 
                         [id]="'addon-'+i+'-'+j"
                         [disabled]="item.active === '0'"
                         class="mr-2">
                  <label [for]="'addon-'+i+'-'+j" 
                         class="cursor-pointer"
                         [class.line-through]="item.active === '0'"
                         [class.text-gray-300]="item.active === '0'">
                    {{item.addonitem_name}}
                  </label>
                </div>
                <div *ngIf="item.active === '0'" class="absolute w-full h-[1px] bg-gray-300"></div>
                <div [class.text-gray-300]="item.active === '0'" class="flex items-center">
                  <div class="font-[550] pr-[2px]">INR</div>{{item.addonitem_price}}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Regular Addons Section (when no variations) -->
      <div *ngIf="(!item?.variation || item.variation.length === 0) && item?.addon && item.addon.length > 0" class="mx-[3.8%] mb-2">
        <div *ngFor="let addonGroup of getRegularAddons(); let i = index" class="rounded-[10px] border-2 mb-4">
          <!-- Similar addon group structure as above -->
          <!-- ... -->
        </div>
      </div>
    </div>

    <!-- Footer Section -->
    <div class="border-t-2 border-[hsl(var(--border))] lg:rounded-b-[10px] items-center flex justify-between py-[8px] sm:px-[24px] px-4">
      <div class="sm:text-[20px] text-[16px] flex items-center">
        <div class="font-[550] pr-[2px]">INR</div>{{total_price}}
      </div>
      <button class="sm:px-[20%] lg:px-4 px-4 flex gap-2 py-[2%] items-center text-white rounded-[10px] text-[16px] font-bold bg-[var(--temp-back)]">
        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em">
          <path d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"/>
        </svg>
        Add to Cart
      </button>
    </div>
  </div>
</div> 